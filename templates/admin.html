{% load static %}
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Admin Dashboard</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
		<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
		<style>
			body { background-color: #f8f9fc; }
			.sidebar { width: 260px; transition: width .2s ease; }
			.content { margin-left: 260px; transition: margin-left .2s ease; }
			.sidebar .nav-link { color: #e2e8f0; }
			.sidebar .nav-link.active, .sidebar .nav-link:hover { background: rgba(255,255,255,0.1); color: #fff; }
			.card-kpi h6 { color: #6c757d; font-weight: 600; text-transform: uppercase; letter-spacing: .03em; }
			.card-kpi .value { font-size: 1.75rem; font-weight: 700; }

			/* Collapsed state */
			.sidebar-collapsed .sidebar { width: 72px; }
			.sidebar-collapsed .content { margin-left: 72px; }
			.sidebar .nav-link i { width: 24px; text-align: center; }
			.sidebar-collapsed .sidebar .label { display: none; }
			.sidebar-collapsed .sidebar .brand-label { display: none; }
		</style>
	</head>
	<body>
		<div class="d-flex">
			<!-- Sidebar -->
			<nav class="sidebar bg-dark min-vh-100 position-fixed">
				<div class="p-3 border-bottom border-secondary d-flex align-items-center gap-2">
					<i class="bi-phone text-white fs-4"></i>
					<span class="text-white fw-bold brand-label">Mobile Shop</span>
				</div>
				<ul class="nav flex-column p-2">
					<li class="nav-item"><a class="nav-link active rounded px-3" href="/dashboard/"><i class="bi-grid me-2"></i><span class="label">Dashboard</span></a></li>
					<li class="nav-item"><a class="nav-link rounded px-3" href="/dashboard/users/"><i class="bi-people me-2"></i><span class="label">Users</span></a></li>
					<li class="nav-item"><a class="nav-link rounded px-3" href="/dashboard/customers/"><i class="bi-person-badge me-2"></i><span class="label">Customers</span></a></li>
					<li class="nav-item"><a class="nav-link rounded px-3" href="/dashboard/orders/"><i class="bi-bag me-2"></i><span class="label">Orders</span></a></li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle rounded px-3" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
							<i class="bi-phone me-2"></i><span class="label">Inventory</span>
						</a>
						<ul class="dropdown-menu">
							<li><a class="dropdown-item" href="/dashboard/inventory/"><i class="bi-grid me-2"></i>View All Phones</a></li>
							<li><a class="dropdown-item" href="/dashboard/inventory/new/"><i class="bi-plus-circle me-2"></i>Add New Phone</a></li>
							<li><hr class="dropdown-divider"></li>
							<li><a class="dropdown-item" href="/dashboard/inventory/"><i class="bi-list me-2"></i>Manage Inventory</a></li>
						</ul>
					</li>
					<li class="nav-item"><a class="nav-link rounded px-3" href="/dashboard/contacts/"><i class="bi-inbox me-2"></i><span class="label">Contacts</span></a></li>
					<li class="nav-item"><a class="nav-link rounded px-3" href="/dashboard/reports/"><i class="bi-bar-chart me-2"></i><span class="label">Reports</span></a></li>
					<li class="nav-item"><a class="nav-link rounded px-3" href="#content"><i class="bi-folder2-open me-2"></i><span class="label">Content</span></a></li>
					<li class="nav-item"><a class="nav-link rounded px-3" href="#settings"><i class="bi-gear me-2"></i><span class="label">Settings</span></a></li>
				</ul>
			</nav>

			<!-- Content -->
			<main class="content w-100">
				<!-- Topbar -->
				<nav class="navbar navbar-expand bg-white shadow-sm sticky-top">
					<div class="container-fluid">
						<div class="d-flex align-items-center gap-2">
							<button class="btn btn-outline-secondary btn-sm" id="sidebarToggle" type="button" aria-label="Toggle sidebar"><i class="bi-layout-sidebar"></i></button>
							<form class="d-none d-md-flex" role="search">
								<input class="form-control" type="search" placeholder="Search..." aria-label="Search" />
							</form>
						</div>
						<ul class="navbar-nav ms-auto align-items-center">
							<li class="nav-item me-2"><a href="/" class="btn btn-outline-primary btn-sm"><i class="bi-house"></i> Site</a></li>
							<li class="nav-item dropdown">
								<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
									<i class="bi-person-circle fs-5"></i>
								</a>
								<ul class="dropdown-menu dropdown-menu-end">
									<li><h6 class="dropdown-header">Admin</h6></li>
									<li><a class="dropdown-item" href="#profile">Profile</a></li>
									<li><a class="dropdown-item" href="#settings">Settings</a></li>
									<li><hr class="dropdown-divider" /></li>
								<li><a class="dropdown-item" href="/logout/">Logout</a></li>
								</ul>
							</li>
						</ul>
					</div>
				</nav>

				<div class="container-fluid py-4">
					<h1 class="h3 mb-4">Mobile Shop Dashboard</h1>

					<!-- KPIs -->
					<div class="row g-3 mb-4">
						<div class="col-sm-6 col-lg-3">
							<div class="card card-kpi shadow-sm">
								<div class="card-body">
									<h6>Total Customers</h6>
									<div class="d-flex justify-content-between align-items-end">
										<div class="value">{{ total_customers }}</div>
										<i class="bi-people fs-4 text-primary"></i>
									</div>
								</div>
							</div>
						</div>
						<div class="col-sm-6 col-lg-3">
							<div class="card card-kpi shadow-sm">
								<div class="card-body">
									<h6>Total Orders</h6>
									<div class="d-flex justify-content-between align-items-end">
										<div class="value">{{ total_orders }}</div>
										<i class="bi-bag fs-4 text-success"></i>
									</div>
								</div>
							</div>
						</div>
						<div class="col-sm-6 col-lg-3">
							<div class="card card-kpi shadow-sm">
								<div class="card-body">
									<h6>Contact Queries</h6>
									<div class="d-flex justify-content-between align-items-end">
										<div class="value">{{ total_contacts }}</div>
										<i class="bi-inbox fs-4 text-info"></i>
									</div>
								</div>
							</div>
						</div>
						<div class="col-sm-6 col-lg-3">
							<div class="card card-kpi shadow-sm">
								<div class="card-body">
									<h6>Pending Orders</h6>
									<div class="d-flex justify-content-between align-items-end">
										<div class="value text-warning">{{ pending_orders }}</div>
										<i class="bi-clock fs-4 text-warning"></i>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Order Status Overview -->
					<div class="row g-3 mb-4">
						<div class="col-sm-6 col-lg-3">
							<div class="card shadow-sm">
								<div class="card-body text-center">
									<i class="bi-hourglass-split fs-2 text-warning mb-2"></i>
									<h5 class="mb-1">{{ pending_orders }}</h5>
									<small class="text-muted">Pending</small>
								</div>
							</div>
						</div>
						<div class="col-sm-6 col-lg-3">
							<div class="card shadow-sm">
								<div class="card-body text-center">
									<i class="bi-gear fs-2 text-info mb-2"></i>
									<h5 class="mb-1">{{ processing_orders }}</h5>
									<small class="text-muted">Processing</small>
								</div>
							</div>
						</div>
						<div class="col-sm-6 col-lg-3">
							<div class="card shadow-sm">
								<div class="card-body text-center">
									<i class="bi-truck fs-2 text-primary mb-2"></i>
									<h5 class="mb-1">{{ shipped_orders }}</h5>
									<small class="text-muted">Shipped</small>
								</div>
							</div>
						</div>
						<div class="col-sm-6 col-lg-3">
							<div class="card shadow-sm">
								<div class="card-body text-center">
									<i class="bi-check-circle fs-2 text-success mb-2"></i>
									<h5 class="mb-1">{{ delivered_orders }}</h5>
									<small class="text-muted">Delivered</small>
								</div>
							</div>
						</div>
					</div>

					<div class="row g-3">
						<div class="col-lg-8">
							<div class="card shadow-sm h-100">
								<div class="card-header bg-white">
									<strong>Recent Orders</strong>
								</div>
								<div class="card-body">
									{% if recent_orders %}
									<ul class="list-group list-group-flush">
										{% for order in recent_orders %}
										<li class="list-group-item d-flex justify-content-between align-items-center">
											<div>
												<strong>Order #{{ order.order_number }}</strong>
												<br>
												<small class="text-muted">{{ order.customer.first_name }} {{ order.customer.last_name }} - {{ order.product_name }}</small>
											</div>
											<div class="text-end">
												<span class="badge {% if order.order_status == 'pending' %}text-bg-warning{% elif order.order_status == 'processing' %}text-bg-info{% elif order.order_status == 'shipped' %}text-bg-primary{% elif order.order_status == 'delivered' %}text-bg-success{% else %}text-bg-secondary{% endif %}">
													{{ order.get_order_status_display }}
												</span>
												<br>
												<small class="text-muted">{{ order.order_date|timesince }} ago</small>
											</div>
										</li>
										{% endfor %}
									</ul>
									{% else %}
									<div class="text-center py-4">
										<i class="bi-bag display-4 text-muted"></i>
										<p class="text-muted mt-2">No recent orders</p>
									</div>
									{% endif %}
								</div>
							</div>
						</div>
						<div class="col-lg-4">
							<div class="card shadow-sm h-100">
								<div class="card-header bg-white"><strong>Quick Actions</strong></div>
								<div class="card-body d-grid gap-2">
									<a href="/dashboard/inventory/" class="btn btn-outline-primary"><i class="bi-phone me-1"></i> <span class="label">View Inventory</span></a>
									<a href="/dashboard/inventory/new/" class="btn btn-outline-success"><i class="bi-plus-circle me-1"></i> <span class="label">Add Phone</span></a>
									<a href="/dashboard/orders/new/" class="btn btn-outline-info"><i class="bi-bag-plus me-1"></i> <span class="label">New Order</span></a>
									<a href="/dashboard/customers/" class="btn btn-outline-warning"><i class="bi-people me-1"></i> <span class="label">Customers</span></a>
									<a href="/dashboard/reports/" class="btn btn-outline-secondary"><i class="bi-bar-chart me-1"></i> <span class="label">View Reports</span></a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</main>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
		<script>
			(function() {
				const body = document.body;
				const toggleBtn = document.getElementById('sidebarToggle');
				const key = 'sidebar-collapsed';
				// Restore state
				if (localStorage.getItem(key) === '1') {
					body.classList.add('sidebar-collapsed');
				}
				toggleBtn?.addEventListener('click', function() {
					body.classList.toggle('sidebar-collapsed');
					const collapsed = body.classList.contains('sidebar-collapsed');
					localStorage.setItem(key, collapsed ? '1' : '0');
				});
			})();
		</script>
	</body>
</html>
